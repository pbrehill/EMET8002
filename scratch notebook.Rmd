---
title: "Acemoglu"
output: html_notebook
---

```{r}
library(tidyverse)
library(grf)
data <- read_csv('titanic.csv')
```
```{r}
data <- data %>% 
    mutate(Sex1 = recode(Sex, 
                      "male" = 0, 
                      "female" = 1))
```


```{r}
cf <- grf::causal_forest(data %>% select(-Survived, -Sex, -Sex1, -Name), data$Survived, data$Sex1)
```

```{r}
evaluate_node <- function (fit, node_num, datapoint) {
  node <- fit[[node_num]]
  
  # Check if node is leaf
  if (node$is_leaf) return(node$leaf_stats)
  
  if (!is.na(datapoint[node$split_variable])) {
    evaluation <- datapoint[node$split_variable] <= node$split_value
  } else {
    evaluation <- node$send_missing_left
  }
  
  if (evaluation) {
    evaluate_node(fit, node$left_child, datapoint)
  } else {
    evaluate_node(fit, node$right_child, datapoint)
  }
}

predict_datapoint <- function (fit, datapoint) {
  if (class(fit) != "grf_tree") stop("Input is not a causal tree")
  
  root_node <- fit$nodes[[1]]
  
  evaluate_node()
}

predict_casual_tree <- function (fit, data) {
  data %>%
    mutate(predicted_y = avg_Y,
           predicted_w = avg_W)
}
```

```{r}
evaluate_node(test_tree, 1, data[2,])
```


```{r}
test_tree <- get_tree(cf, 11)

rpart_tree <- rpart(Survived ~ ., data = data %>% select(-Sex1, -Name))
plot(test_tree)

# predict(test_tree, data)
```

